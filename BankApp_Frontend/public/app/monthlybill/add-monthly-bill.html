<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.6
Version: 4.5.6
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
Renew Support: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <!-- BEGIN HEAD -->

<head>
    <meta charset="utf-8" />
    <title>Monthly Bill</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="../assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="../assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <link href="../assets/layouts/layout3/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/layouts/layout3/css/themes/default.min.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="../assets/layouts/layout3/css/custom.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME LAYOUT STYLES -->
</head>

<body class="page-container-bg-solid page-header-menu-fixed">
    <!-- BEGIN HEADER -->
    <div class="page-header">
        <!-- BEGIN HEADER TOP -->
        <div class="page-header-top">
            <div class="container">
                <!-- BEGIN LOGO -->
                <div class="page-logo">
                    <a href="../user/homepage.html">
                        <img src="../assets/app/images/logo_small.png" alt="logo" class="logo-default">
                    </a>
                </div>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="menu-toggler"></a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <div class="top-menu">
                    <ul class="nav navbar-nav pull-right">
                        <!-- BEGIN USER LOGIN DROPDOWN -->
                        <li class="dropdown dropdown-user dropdown-dark">
                            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                <img id="header-picture" alt="" class="img-circle" src="">
                                <span id="user" class="username username-hide-mobile"></span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-default">
                                <li>
                                    <a href="../user/profile.html">
                                        <i class="icon-user"></i> My Profile </a>
                                </li>
                                
                                <li>
                                    <a href="../index.html">
                                        <i id="logout" class="icon-key"></i> Log Out </a>
                                </li>
                            </ul>
                        </li>
                        <!-- END USER LOGIN DROPDOWN -->
                        
                    </ul>
                </div>
                <!-- END TOP NAVIGATION MENU -->
            </div>
        </div>
        <!-- END HEADER TOP -->
        <!-- BEGIN HEADER MENU -->
        <div class="page-header-menu">
            <div class="container">
                <!-- BEGIN MEGA MENU -->
                <!-- DOC: Apply "hor-menu-light" class after the "hor-menu" class below to have a horizontal menu with white background -->
                <!-- DOC: Remove data-hover="dropdown" and data-close-others="true" attributes below to disable the dropdown opening on mouse hover -->
                <div class="hor-menu  ">
                    <ul class="nav navbar-nav">
                        <li class="menu-dropdown classic-menu-dropdown active">
                            <a href="javascript:;"> Account
                                <span class="arrow"></span>
                            </a>
                            <ul class="dropdown-menu pull-left">
                                <li class=" ">
                                    <a href="../user/homepage.html" class="nav-link  ">
                                        View Accounts
                                    </a>
                                </li>

                                <li class=" ">
                                    <a href="../transfer/transaction-history.html" class="nav-link  ">
                                        View Transaction History
                                    </a>
                                </li>

                                <li class=" ">
                                    <a href="../recurringpayment/all-recurring-payments.html" class="nav-link  ">
                                        View Recurring Payments
                                    </a>
                                </li>
                            

                                <li class=" ">
                                    <a href="../monthlybill/all-monthly-bills.html" class="nav-link  ">
                                        View Monthly Bills
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="menu-dropdown classic-menu-dropdown active">
                            <a href="javascript:;"> Transfer
                                <span class="arrow"></span>
                            </a>
                            <ul class="dropdown-menu pull-left">
                                <li class=" ">
                                    <a href="../transfer/transfer-funds.html" class="nav-link  ">
                                        Transfer Funds
                                    </a>
                                </li>

                                <li class=" ">
                                    <a href="../transfer/foreign-transfer.html" class="nav-link  ">
                                        Transfer Funds Overseas
                                    </a>
                                </li>

                                <li class=" ">
                                    <a href="../monthlybill/add-monthly-bill.html" class="nav-link  ">
                                        Pay Monthly Bills
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="menu-dropdown classic-menu-dropdown active">
                            <a href="javascript:;"> Payee
                                <span class="arrow"></span>
                            </a>
                            <ul class="dropdown-menu pull-left">
                                <li class=" ">
                                    <a href="../payee/add-payee.html" class="nav-link  ">
                                        Add Payee
                                    </a>
                                </li>
                                <li class=" ">
                                    <a href="../payee/all-payees.html" class="nav-link  ">
                                        View Payees
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="menu-dropdown classic-menu-dropdown active">
                            <a href="javascript:;"> Cards
                                <span class="arrow"></span>
                            </a>
                            <ul class="dropdown-menu pull-left">
                                <li class=" ">
                                    <a href="../card/add-card.html" class="nav-link  ">
                                        Add Card
                                    </a>
                                </li>
                                <li class=" ">
                                    <a href="../card/all-cards.html" class="nav-link  ">
                                        View Cards
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="menu-dropdown classic-menu-dropdown active">
                            <a href="javascript:;"> Settings
                                <span class="arrow"></span>
                            </a>
                            <ul class="dropdown-menu pull-left">
                                <li class=" ">
                                    <a href="../user/profile.html" class="nav-link  ">
                                        My Profile
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- END MEGA MENU -->
            </div>
        </div>
        <!-- END HEADER MENU -->
    </div>
    <!-- END HEADER -->
    
    <!-- BEGIN PAGE CONTENT BODY -->
    <div class="page-content">
        <div class="container">
            <!-- BEGIN PAGE CONTENT INNER -->
            <div class="page-content-inner">
                <div class="portlet light portlet-fit ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class=" icon-layers font-green"></i>
                            <span class="caption-subject font-green bold uppercase"> Pay Monthly Bills</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <!-- BEGIN FORM-->

                        <!-- container for errors if thrown by server -->
                        <div id='errorMsg' class="alert alert-danger display-hide"></div>

                        <form id="payment-form" class="form-horizontal">
                            <div class="form-body">
                                <h3 class="form-section">To:</h3>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Billing Organization: </label>
                                    <div class="col-md-4">
                                        <select id="billingOrganization" class="form-control" required></select>
                                    </div>
                                </div>

                                <h3 class="form-section">From:</h3>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Card: </label>
                                    <div class="col-md-4">
                                        <select id="card" class="form-control" required></select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">PIN: </label>
                                    <div class="col-md-4">
                                        <input id="pin" name="pin" type="text" class="form-control" value="">   
                                    </div>
                                </div>

                                <h3 class="form-section">Details:</h3>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Amount: </label>
                                    <div class="col-md-4">
                                        <input id="amount" name="amount" type="text" class="form-control" value="">     
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-3 control-label">Description: </label>
                                    <div class="col-md-4">
                                        <textarea id="description" class="form-control"></textarea>     
                                    </div>
                                </div>
                                
                                
                            </div>
                            <div>
                                <div class="row">
                                    <div class="col-md-offset-3 col-md-9">
                                        <button id="submit" type="button" class="btn green">Add Payment</button>
                                        <a href="../user/homepage.html" class="btn default">Back</a>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- END FORM-->

                        <!-- modal for payment adding success-->
                        <div class="modal fade" id="successModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-hidden="true">
                          <div class="modal-dialog" >
                            <div class="modal-content">
                              <div class="modal-header">
                                <h4 class="modal-title">Monthly Payment Success</h4>
                              </div>
                              <div class="modal-body">
                                Monthly Bill Payment has been successfully added. 
                              </div>
                              <div class="modal-footer">
                                <button id="success-btn" type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>

                    </div>
                </div>
            </div>
          <!-- END PAGE CONTENT INNER -->
        </div>
    </div>
    <!-- END PAGE CONTENT BODY -->
    <!-- END CONTENT BODY -->
    <!-- END CONTENT -->
    
    <!-- BEGIN CORE PLUGINS -->
    <script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <!-- BEGIN THEME GLOBAL SCRIPTS -->
    <script src="../assets/global/scripts/app.min.js" type="text/javascript"></script>
    <!-- END THEME GLOBAL SCRIPTS -->
    <!-- BEGIN THEME LAYOUT SCRIPTS -->
    <script src="../assets/layouts/layout3/scripts/layout.min.js" type="text/javascript"></script>
    <script src="../assets/layouts/layout3/scripts/demo.min.js" type="text/javascript"></script>
    <script src="../assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
    <!-- END THEME LAYOUT SCRIPTS -->
    <!-- APP IMPORTS -->
    <script src="../assets/app/js/jquery.validate.js"></script>
    <script src="../assets/app/js/protect.js"></script>
    <script src="../assets/app/js/apiUrl.js"></script>
    <script src="../assets/app/js/card.js"></script>
    <script src="../assets/app/js/account.js"></script>
    <script src="../assets/app/js/monthlybill.js"></script>
    <script src="../assets/app/js/user.js"></script>

    <script>
        //method from protect js to redirect if session invalid
        protect();
        protectOTP();
        $(document).ready(function() {

            //set user's name
            getUser(sessionStorage.userID, function(callback) {
                $('#user').html(callback.fullName);
            });

            //get user profile picture
            getProfilePicture(function(callback) {
                if (callback.message != null && atob(callback.message) != "undefined"){
                    $('#header-picture').attr("src", function(i, value) {
                        //decrypt base64 from json string then encode back to base64
                        return "data:image/jpg;base64," + btoa(atob(callback.message));
                    });
                } else {
                    $('#header-picture').attr("src", function(i, value) {
                        return "../assets/app/images/profile_picture_default.png"
                    });
                }
                
            });

            //get all billing organizations available for monthly payments
            getBillingOrganization(function(callback) {
                var billingOrganizationList = callback;
                for(var i = 0; i < billingOrganizationList.length; i++) {
                    var billingOrganization = billingOrganizationList[i].organization;
                    $('#billingOrganization').append($('<option>', {
                        value: billingOrganization,
                        text: billingOrganization
                    }))
                }
            })

            //get all cards owned by user
            getAllAccountByUser(sessionStorage.userID, function (callback) {
                var accounts = callback;

                for (var i = 0; i < accounts.length; i++) {
                    var accountNumber = accounts[i].accountNumber;
                    getAllCardsByAccount(accountNumber, function(callback) {
                        var cards = callback;
                        
                        for(var i = 0; i < cards.length; i++) {
                            var card = cards[i];
                            $('#card').append($('<option>', {
                                value: card.cardNumber,
                                text: card.cardNumber
                            }))
                        }
                    });
                }
            });

            //validate the input fields
             $("#payment-form").validate({
                rules: {
                    amount: {
                      required: true,
                      number:true
                    },
                    pin: {
                        required: true,
                        digits: true
                    }
                    
                }
            });

            $('#submit').click(function () {
                if($('#payment-form').valid()) {
                    addNewMonthlyBill(function(callback) {
                        if (callback != null) {
                            $('#errorMsg').html(callback);
                            $('#errorMsg').show();
                        }
                        
                    });
                }
            });

            //redirect from modal close button
            $('#success-btn').click(function () {
                window.location.replace(domainUrl + "/monthlybill/all-monthly-bills.html");
            })
            
        });
    </script>
</body>
</html>